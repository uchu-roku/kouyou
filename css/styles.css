:root{
  --bg:#0b1220; --panel:#0f172a; --muted:#cbd5e1; --text:#e6edf3;
  --accent:#22d3ee; --accent-2:#34d399;
  --prioA:#38bdf8; --prioB:#a3e635; --prioC:#f59e0b;
  --focus:#f59e0b; --border:#1f2937; --control:#0b1530;
}
html,body{height:100%}
body{margin:0;background:var(--bg);color:var(--text);
  font:15px/1.6 system-ui,-apple-system,Segoe UI,Roboto,'Noto Sans JP','Hiragino Kaku Gothic ProN','Yu Gothic UI',Meiryo,sans-serif;
  -webkit-font-smoothing:antialiased;text-rendering:optimizeLegibility}
*:focus-visible{outline:3px solid var(--focus);outline-offset:2px}

header{padding:12px 16px;border-bottom:1px solid var(--border);display:flex;gap:12px;align-items:center;flex-wrap:wrap}
header h1{margin:0 8px 0 0;font-size:18px;letter-spacing:.02em}
.container{display:grid;grid-template-columns:420px 1fr;gap:12px;height:calc(100% - 57px);padding:12px}
@media (max-width:1080px){.container{grid-template-columns:1fr;grid-auto-rows:minmax(0,1fr)}}

.panel{background:var(--panel);border:1px solid var(--border);border-radius:14px;overflow:hidden}
.panel header{border:0;background:rgba(255,255,255,.02)}
.panel .body{padding:12px}
#map{height:100%;min-height:420px}

.controls{display:grid;gap:12px}
.row{display:grid;grid-template-columns:1fr 1fr;gap:10px}
.row-3{display:grid;grid-template-columns:1fr 1fr 1fr;gap:10px}
.stack{display:grid;gap:8px}
label{font-size:13px;color:var(--muted)}
input[type="number"],select,input[type="text"],input[type="search"],input[type="range"]{width:100%;padding:12px 12px;border-radius:12px;border:1px solid #263042;background:var(--control);color:var(--text);min-height:44px}
input[type="file"]{width:100%}
button{padding:12px 14px;border-radius:12px;border:1px solid #263042;background:var(--control);color:var(--text);cursor:pointer;min-height:44px}
button.solid{background:linear-gradient(180deg,#1b2a4d,#101a34);border-color:#2b3a59}
button.ghost{background:transparent}
.pill{display:inline-flex;align-items:center;gap:8px;padding:6px 10px;border-radius:999px;background:#0b1530;border:1px solid #263042;white-space:nowrap}
.small{font-size:12.5px}
.toolbar{display:flex;gap:8px;align-items:center;padding:8px 10px;border-bottom:1px solid var(--border)}
.toolbar .spacer{flex:1}
.hint{font-size:12.5px;color:var(--muted)}
.count{font-variant-numeric:tabular-nums}

.kpis{display:grid;grid-template-columns:repeat(3,1fr);gap:10px}
.kpi{background:#0b1530;border:1px solid #263042;border-radius:12px;padding:10px 12px}
.kpi .label{font-size:12.5px;color:#b7c3d7}
.kpi .val{font-size:18px;font-weight:700;margin-top:4px;letter-spacing:.02em}

.futureBar{display:grid;gap:10px}
.futureRow{display:grid;grid-template-columns:auto 1fr auto auto;gap:10px;align-items:center}
.badge{display:inline-flex;align-items:center;gap:6px;padding:4px 8px;border-radius:999px;background:#0e203d;border:1px solid #223a63;font-size:12px}
.priceCtrl{display:grid;grid-template-columns:auto 1fr auto;gap:10px;align-items:center}

table{width:100%;border-collapse:collapse}
thead th{position:sticky;top:0;background:#0e1526;font-weight:700}
th,td{padding:9px 10px;border-bottom:1px solid var(--border);white-space:nowrap}
tbody tr:hover{background:#0f1a31}
.tag{display:inline-block;padding:3px 8px;border-radius:999px;font-size:12.5px;border:1px solid #223049}
.A{color:var(--prioA);border-color:#155e75}
.B{color:var(--prioB);border-color:#3f6212}
.C{color:var(--prioC);border-color:#854d0e}

.legend{background:#0b1220;border:1px solid #263042;border-radius:10px;padding:6px 8px;line-height:1.2;max-width:320px}
.legend .head{display:flex;align-items:center;gap:8px;margin-bottom:4px}
.legend .spacer{flex:1}
.legend .btn{font-size:12px;color:#cbd5e1;border:1px solid #334155;background:#0e1627;border-radius:8px;padding:4px 8px;cursor:pointer}
.legend .sectionTitle{margin:6px 0 4px;font-size:12.5px;text-decoration:underline;color:#cbd5e1}
.legend .item{display:flex;align-items:center;gap:6px;margin:3px 0}
.legend .swatch{width:12px;height:12px;border-radius:3px;border:1px solid #1f2937;display:inline-block}
.legend .icon{display:inline-flex;align-items:center;justify-content:center;width:18px;height:16px}
.legend .meta{color:#94a3b8;font-size:12px;margin-top:4px}
#speciesLegend{max-height:22vh;overflow:auto;padding-right:4px;margin-right:-2px}
.legend.min .sectionTitle,.legend.min #speciesLegend,.legend.min #legendMeta{display:none}
.legend.min{padding:6px 8px}

.speciesSummary{background:#0b1220;border:1px solid #263042;border-radius:12px;padding:8px;max-width:380px;box-shadow:0 6px 16px rgba(0,0,0,.35)}
.speciesSummary .head{display:flex;gap:8px;align-items:center;margin-bottom:4px}
.speciesSummary .spacer{flex:1}
.speciesSummary .btn{font-size:12px;color:#cbd5e1;border:1px solid #334155;background:#0e1627;border-radius:8px;padding:4px 8px;cursor:pointer}
.speciesSummary table{width:100%;border-collapse:collapse}
.speciesSummary th,.speciesSummary td{border-bottom:1px solid #1f2937;padding:4px 6px;font-variant-numeric:tabular-nums}
.speciesSummary th{position:static;background:transparent;font-weight:700;font-size:12px;color:#cbd5e1}
.speciesSummary td{font-size:13px}
.speciesSummary .list{max-height:24vh;overflow:auto;padding-right:4px;margin-right:-2px}
.speciesSummary.min .list,.speciesSummary.min table,.speciesSummary.min #speciesSummaryMeta{display:none}
.speciesSummary.min{padding:6px 8px}
.speciesSummary .spIcon{display:inline-flex;align-items:center;justify-content:center;width:18px;height:16px}
.speciesSummary .meta{color:#94a3b8;font-size:12px;margin-top:4px}

.dropzone{margin-top:8px;border:2px dashed #334155;border-radius:12px;padding:18px;text-align:center;background:#0b1530;color:var(--muted);transition:all .15s}
.dropzone.dragover{border-color:var(--accent);background:#071423;color:#8be9ff;box-shadow:0 0 0 3px rgba(34,211,238,.2) inset}

.mark{position:relative;transform:translate(-50%,-50%);width:26px;height:26px;border-radius:50%;display:flex;align-items:center;justify-content:center;background:#0b1220cc;border:2px solid #64748b;box-shadow:0 2px 6px rgba(0,0,0,.35)}
.ring-A{border-color:var(--prioA)} .ring-B{border-color:var(--prioB)} .ring-C{border-color:var(--prioC)}
.emoji{font-size:16px;line-height:1}

.fir{position:relative;width:14px;height:16px}
.fir .tri{position:absolute;left:50%;transform:translateX(-50%);width:0;height:0;border-left:7px solid transparent;border-right:7px solid transparent}
.fir .t1{bottom:2px;border-bottom:6px solid #0b5132}
.fir .t2{bottom:6px;border-bottom:6px solid #0f6a3a}
.fir .t3{bottom:10px;border-bottom:6px solid #157a45}
.fir .trunk{position:absolute;bottom:0;left:50%;transform:translateX(-50%);width:3px;height:4px;background:#6b4f2a;border-radius:1px}

.larch{position:relative;width:14px;height:16px}
.larch .tri{position:absolute;left:50%;transform:translateX(-50%);width:0;height:0;border-left:7px solid transparent;border-right:7px solid transparent}
.larch .t1{bottom:2px;border-bottom:6px solid #8a6d1f}
.larch .t2{bottom:6px;border-bottom:6px solid #b28a2a}
.larch .t3{bottom:10px;border-bottom:6px solid #d8b24c}
.larch .trunk{position:absolute;bottom:0;left:50%;transform:translateX(-50%);width:3px;height:4px;background:#6b4f2a;border-radius:1px}

.birch{position:relative;width:14px;height:16px}
.birch .crown{position:absolute;bottom:6px;left:50%;transform:translateX(-50%);width:14px;height:10px;background:#2f8b3a;border-radius:7px}
.birch .trunk{position:absolute;bottom:0;left:50%;transform:translateX(-50%);width:3px;height:8px;background:#ffffff;border-radius:1px;box-shadow:0 0 0 1px rgba(0,0,0,.15) inset}
.birch .spot1,.birch .spot2,.birch .spot3{position:absolute;width:2px;height:1px;background:#333}
.birch .spot1{bottom:5px;left:6px}
.birch .spot2{bottom:3px;left:7px}
.birch .spot3{bottom:1px;left:5px}

@media (max-width:520px){
  .row,.row-3{grid-template-columns:1fr}
  .futureRow{grid-template-columns:1fr}
  .kpis{grid-template-columns:1fr}
}

/* v1.1.1 追加: Leaflet/凡例/サマリを確実に前面へ */
.legend, .speciesSummary { z-index: 1000; }
.leaflet-control-container { z-index: 995; }
#map .leaflet-pane, #map .leaflet-top, #map .leaflet-bottom { z-index: 990; }
