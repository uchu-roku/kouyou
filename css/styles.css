/* ===== 林業テーマ：緑・茶・白 + アクセント=オレンジ（最終版・軽量） ===== */
:root{
  --bg:#fff; --panel:#f7f5f0; --text:#2b2b2b; --muted:#6b7280;
  --forest:#2E6B3F; --earth:#8B5E3C;
  --accent:#E97432; --accent-ink:#23160f;
  --border:#e2ded6; --hover:#f2efe8; --focus:#ffeadb;
  --ok:#0f9d58; --warn:#f59e0b; --danger:#dc2626;
  --shadow:0 6px 20px rgba(36,24,10,.08);
  --control:#fff;
}

/* レイアウトは既存どおり（containerのgridなどはそのまま使ってOK） */
html,body{height:100%}
body{
  margin:0; background:var(--bg); color:var(--text);
  font:15px/1.55 system-ui,-apple-system,Segoe UI,Roboto,"Noto Sans JP","Hiragino Kaku Gothic ProN","Yu Gothic UI",Meiryo,sans-serif;
}
*:focus-visible{outline:3px solid var(--focus); outline-offset:2px}

header{padding:12px 16px; border-bottom:1px solid var(--border); display:flex; gap:12px; align-items:center; flex-wrap:wrap}
header h1{margin:0 8px 0 0; font-size:18px; letter-spacing:.02em}

/* panel */
.panel{background:var(--panel); border:1px solid var(--border); border-radius:14px; overflow:hidden; box-shadow:var(--shadow)}
.panel header{border:0; background:rgba(0,0,0,.02)}
.panel .body{padding:12px}

/* form */
label{font-size:13px; color:var(--muted)}
input[type="number"],select,input[type="text"],input[type="search"],input[type="range"]{
  width:100%; padding:12px; min-height:44px; border-radius:12px;
  border:1px solid var(--border); background:var(--control); color:var(--text);
}
input[type="file"]{width:100%}
input:focus,select:focus{outline:2px solid var(--focus); border-color:var(--accent)}

/* buttons（index.htmlの .solid / .ghost に対応） */
button{
  padding:12px 14px; min-height:44px; border-radius:12px; cursor:pointer;
  border:1px solid var(--border); background:var(--control); color:var(--text);
}
button.solid{background:var(--accent); color:var(--accent-ink); border-color:transparent}
button.solid:hover{filter:brightness(0.98)}
button.ghost{background:#fff; color:var(--forest); border-color:var(--forest)}
button.ghost:hover{background:var(--hover)}

/* pill */
.pill{display:inline-flex; align-items:center; gap:8px; padding:6px 10px; border-radius:999px; background:#fff; border:1px solid var(--border); white-space:nowrap}
.small{font-size:12.5px}

/* KPI */
.kpis{display:grid; grid-template-columns:repeat(3,1fr); gap:10px}
.kpi{background:#fff; border:1px solid var(--border); border-radius:12px; padding:10px 12px; box-shadow:var(--shadow)}
.kpi .label{font-size:12.5px; color:var(--muted)}
.kpi .val{font-size:18px; font-weight:700; margin-top:4px; letter-spacing:.02em; color:var(--forest)}

/* table */
table{width:100%; border-collapse:collapse}
thead th{position:sticky; top:0; background:#fff; font-weight:700}
th,td{padding:9px 10px; border-bottom:1px solid var(--border); white-space:nowrap}
tbody tr:nth-child(even){background:#faf8f3}
tbody tr:hover{background:#fff2e8}

/* legend / summary */
.legend,.speciesSummary{background:#fff; border:1px solid var(--border); border-radius:12px; box-shadow:var(--shadow)}
.legend{padding:6px 8px; max-width:320px; line-height:1.2}
.legend .btn,.speciesSummary .btn{font-size:12px; color:var(--text); border:1px solid var(--border); background:#fff; border-radius:8px; padding:4px 8px; cursor:pointer}
.legend .sectionTitle{margin:6px 0 4px; font-size:12.5px; text-decoration:underline; color:var(--text)}
.legend .swatch{width:12px; height:12px; border-radius:3px; border:1px solid var(--border); display:inline-block}
.legend .meta,.speciesSummary .meta{color:var(--muted); font-size:12px}

/* dropzone */
.dropzone{margin-top:8px; border:2px dashed var(--border); border-radius:12px; padding:18px; text-align:center; background:#fff; color:var(--muted); transition:.15s}
.dropzone.dragover{border-color:var(--accent); background:#fff9f3; color:#a35424; box-shadow:0 0 0 3px rgba(233,116,50,.18) inset}

/* priority tag */
.tag{display:inline-block; padding:3px 8px; border-radius:999px; font-size:12.5px; border:1px solid var(--border); color:var(--text)}
.A{color:#2579a6; border-color:#2579a6}
.B{color:#6b8e23; border-color:#6b8e23}
.C{color:#b06b19; border-color:#b06b19}

/* Leaflet 前面制御 */

/* レイアウト（左420px／右フレキシブル） */
.container{
  display:grid;
  grid-template-columns:420px 1fr;
  gap:12px;
  height:calc(100% - 57px);
  padding:12px;
}
@media (max-width:1080px){
  .leftPanel{ padding-bottom:8px; }
}

/* 地図の高さ */
#map{ height:100%; min-height:420px; }

.legend,.speciesSummary{z-index:1000}
.leaflet-control-container{z-index:995}
#map .leaflet-pane, #map .leaflet-top, #map .leaflet-bottom{z-index:990}

/* === マーカーを見やすく（サイズUP & 枠色＝優先度） === */
:root{
  /* 優先度カラー（地図で映える配色） */
  --prioA:#1e854a;  /* A = 緑（優先） */
  --prioB:#d97706;  /* B = アンバー */
  --prioC:#b91c1c;  /* C = 赤 */
}

/* カスタムマーカーの見た目（divIcon） */
.mark{
  position:relative;
  transform:translate(-50%,-50%);
  width:30px;               /* ← 28-30px が視認性◎ */
  height:30px;
  border-radius:50%;
  display:flex; align-items:center; justify-content:center;
  background:#ffffffee;     /* 明るい縁取りで地図上でも見える */
  border:3px solid #64748b; /* デフォルト枠（優先度なしの時） */
  box-shadow:0 2px 8px rgba(0,0,0,.25);
}
.emoji{ font-size:18px; line-height:1 } /* アイコンの大きさ */

.ring-A{ border-color:var(--prioA) !important; }
.ring-B{ border-color:var(--prioB) !important; }
.ring-C{ border-color:var(--prioC) !important; }

/* 大きな画面ではさらに少し大きく */
@media (min-width:1400px){
  .mark{ width:34px; height:34px; }
  .emoji{ font-size:20px; }
}

/* === 左カラムが全部見えるように：中身をスクロール === */
.leftPanel{ height:100%; display:grid; grid-template-rows:auto 1fr; }
.leftPanel .body{ overflow:auto; }

/* === 影をスマホで軽く（ご希望のメディアクエリ） === */
@media (max-width: 520px){
  :root{ --shadow: 0 3px 10px rgba(36,24,10,.06); }
}

/* Leaflet の divIcon が枠や余白を持たないよう明示（環境差対策）*/
.leaflet-div-icon{ background:transparent; border:none; }

/* 種別サマリ表を縦スクロールにする */
.speciesSummary .list{
  max-height: 200px;   /* 好きな高さに調整可能 */
  overflow-y: auto;    /* 縦スクロール */
  overflow-x: hidden;  /* 横スクロール禁止 */
}

/* セルは折り返し許可 */
.speciesSummary table th,
.speciesSummary table td{
  white-space: normal; /* nowrapを上書きして折り返し */
}

/* 左カラムを縦スクロールにする（横スクロールは消す） */
.leftPanel{ 
  height: 100%;
  overflow: hidden;               /* 横スクロールの発生源を断つ */
}
.leftPanel > header{
  height: 100%;                   /* パネルの高さを満たす */
  display: grid;                  /* タイトル行 + 本文 */
  grid-template-rows: auto 1fr;   /* 上: ヘッダ行 / 下: 本文(スクロール) */
}
.leftPanel > header .body{
  min-height: 0;                  /* grid内でoverflowを効かせる必須指定 */
  overflow-y: auto;               /* 縦スクロール */
  overflow-x: hidden;             /* 横は出さない */
}

/* ページ最上部のヘッダーだけをflexに（パネル内headerへは当てない） */
body > header{
  padding:12px 16px; border-bottom:1px solid var(--border);
  display:flex; gap:12px; align-items:center; flex-wrap:wrap;
}

/* 左パネル内のheaderはgridにして .body に高さを割り当てる */
.leftPanel{ height:100%; overflow:hidden; } /* 横スクロールの発生源を断つ */

.leftPanel > header{
  height:100%;
  display:grid !important;        /* ← global header を上書き */
  grid-template-rows:auto 1fr;    /* 上: 見出し行 / 下: 本文(スクロール) */
}

.leftPanel > header .body{
  min-height:0;                   /* grid内でoverflowを効かせる必須 */
  overflow-y:auto;                /* 縦スクロール */
  overflow-x:hidden;              /* 横は出さない */
}

/*（お好みで）小画面時に下余白が欲しければこれを残す */
@media (max-width:1080px){
  .leftPanel{ padding-bottom:8px; }
}
